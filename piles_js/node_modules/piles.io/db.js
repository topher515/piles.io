(function() {
  var dbClient, mongodb, settings, sys;
  mongodb = require('mongodb');
  sys = require('sys');
  settings = (require('piles.io/settings')).settings;
  exports.mongoServer = new mongodb.Server(settings['MONGO_HOST'], settings['MONGO_PORT'], {});
  exports.db = new mongodb.Db(settings['MONGO_DB_NAME'], exports.mongoServer, {});
  dbClient = null;
  exports.collection = function(name, cb) {
    var getCollection;
    getCollection = function(client, name) {
      return client.collection(name, function(err, coll) {
        if (err) {
          console.log(err);
        }
        return cb(coll);
      });
    };
    if (dbClient) {
      return getCollection(dbClient, name);
    } else {
      return exports.db.open(function(err, client) {
        if (err) {
          console.log(err);
        }
        dbClient = client;
        return getCollection(dbClient, name);
      });
    }
  };
}).call(this);
