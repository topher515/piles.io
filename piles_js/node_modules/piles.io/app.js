(function() {
  var app, express, pio, server, settings, stache, sys, _;
  sys = require('sys');
  express = require('express');
  _ = require('underscore');
  stache = require('stache');
  settings = (require('piles.io/settings')).env('development');
  pio = require('piles.io/io.js');
  server = require('piles.io/server');
  app = express.createServer();
  app.listen(7070);
  app.configure(function() {
    app.use(express.logger());
    app.use(express.bodyParser());
    app.use(express.methodOverride());
    app.use(express.cookieParser());
    app.use(express.session({
      secret: settings.SECRET_KEY
    }));
    app.set('views', settings.DIRNAME + '/views');
    app.set('view engine', 'mustache');
    app.register(".mustache", stache);
    return app.helpers({
      settings: settings
    });
  });
  pio.listen(app);
  server.register(app);
  sys.puts('Server started at localhost:7070');
}).call(this);
