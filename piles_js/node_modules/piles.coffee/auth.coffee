db      = require 'piles.io/db'

exports.doLogin = (req, user, piles) ->
    req.session.authenticated = {user:user}
    if piles 
        req.session.authenticated.piles = piles
    else          
        db.collection 'piles', (piles)->
            (piles.find {emails:user.email}).toArray (err, piles) ->
                req.session.authenticated.piles = piles
