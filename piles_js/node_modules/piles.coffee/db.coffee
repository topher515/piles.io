mongodb     = require 'mongodb'
sys         = require 'sys'
settings    = (require 'piles.io/settings').settings


exports.mongoServer = new mongodb.Server(settings['MONGO_HOST'], settings['MONGO_PORT'], {})

exports.db = new mongodb.Db(settings['MONGO_DB_NAME'], exports.mongoServer, {})

dbClient = null

exports.collection = (name, cb)->
    
    getCollection = (client,name)->
        client.collection name, (err, coll)->
            console.log err if err
            cb (coll)
    
    if dbClient
        getCollection dbClient, name
    else
        exports.db.open (err,client) ->
            console.log err if err
            dbClient = client
            getCollection dbClient, name