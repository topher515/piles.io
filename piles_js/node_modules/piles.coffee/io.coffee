socketio = require 'socket.io'

auth = require 'piles.io/auth'
socketbone = require 'piles.io/socketbone'


exports.listen = (app)->
    
    io = socketio.listen(app)

    
### Setup the app
exports.listen = function(app) {
      
    var socket = socketio.listen(app),
        socketboner = socketbone.listen(socket);
    
    socketboner.on('/piles/:pid','read', function(pid, responder) {
        var pile; 
        await {
            db.collection('piles').findOne({pid:pid}, defer(pile));
        }
        responder.success(pile);
    });
    
    socket.on('connection', function(client) {
        client.emit();
    });
    
    socket.set('authorization', function(data,accept) {
        if (data.headers.cookie) {
            data.cookie = connect.utils.parseCookie(data.headers.cookie);
            data.sessionId = data.cookie;
        } else {
            return accept('No cookie found.', false);
        }
    });
    
};###