sys         = require 'sys'
express     = require 'express'
_           = require 'underscore'
stache      = require 'stache'

#pio         = require 'piles.io/io.js'
settings    = (require 'piles.io/settings').env('development')
server      = require 'piles.io/server'


# Setup the express application
app = express.createServer()
app.listen 7070

app.configure ()->
    app.use express.logger() # print requests to stdout
    app.use express.bodyParser()
    app.use express.cookieParser()
    app.use express.session { secret: settings.SECRET_KEY }
    app.set 'views', settings.DIRNAME+'/views'
    app.set 'view engine', 'mustache'
    app.register ".mustache", stache
    #app.set 'view engine', 'ejs'
    app.helpers { settings: settings } # Pass settings to templates

#pio.listen app

server.register app

sys.puts 'Server started at localhost:7070'